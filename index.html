<!doctype html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Kalkulator</title>
    <style>
        :root{--bg:#0f1724;--panel:#0b1220;--accent:#06b6d4;--btn:#1f2937;--txt:#e6eef6}
        *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;}
        html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#04202a);color:var(--txt);display:flex;align-items:center;justify-content:center}
        .calc{width:340px;background:linear-gradient(180deg,var(--panel),#071022);border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(2,6,23,.6)}
        .display{height:64px;background:#06121a;border-radius:8px;padding:12px 14px;display:flex;flex-direction:column;justify-content:center;align-items:flex-end;overflow:hidden}
        .history{font-size:13px;color:rgba(230,238,246,.6);opacity:.8;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%}
        .output{font-size:26px;font-weight:600;line-height:1;margin-top:4px}
        .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:14px}
        button{height:52px;border-radius:8px;border:0;background:var(--btn);color:var(--txt);font-size:18px;font-weight:600;cursor:pointer}
        button.op{background:linear-gradient(180deg,#04414b,#063d4a);color:#fff}
        button.equal{grid-column:span 2;background:linear-gradient(180deg,var(--accent),#028296);box-shadow:0 6px 18px rgba(6,182,212,.18)}
        button.wide{grid-column:span 2}
        .muted{background:transparent;color:rgba(230,238,246,.7);font-weight:600}
        @media (max-width:380px){.calc{width:94vw}}
    </style>
</head>
<body>
    <main class="calc" role="application" aria-label="Kalkulator">
        <div class="display" id="display">
            <div class="history" id="history">&nbsp;</div>
            <div class="output" id="output">0</div>
        </div>

        <div class="grid" id="keys" aria-hidden="false">
            <button class="muted" data-action="clear">AC</button>
            <button class="muted" data-action="back">⌫</button>
            <button class="muted" data-value="%" title="persen">%</button>
            <button class="op" data-value="/">÷</button>

            <button data-value="7">7</button>
            <button data-value="8">8</button>
            <button data-value="9">9</button>
            <button class="op" data-value="*">×</button>

            <button data-value="4">4</button>
            <button data-value="5">5</button>
            <button data-value="6">6</button>
            <button class="op" data-value="-">−</button>

            <button data-value="1">1</button>
            <button data-value="2">2</button>
            <button data-value="3">3</button>
            <button class="op" data-value="+">+</button>

            <button data-value="0" class="wide">0</button>
            <button data-value=".">.</button>
            <button class="equal" data-action="equals">=</button>
        </div>
    </main>

    <script>
        // Simple safe evaluator and UI logic
        const display = document.getElementById('output');
        const history = document.getElementById('history');
        const keys = document.getElementById('keys');

        let expr = '';

        function updateDisplay() {
            display.textContent = expr === '' ? '0' : expr;
        }

        function sanitizeForEval(s) {
            // allow digits, basic operators, parentheses, dot, percent and spaces
            if (!/^[0-9+\-*/().% ]*$/.test(s)) throw new Error('Invalid input');
            // convert % to /100 for evaluation: replace occurrences like 50% -> (50/100)
            s = s.replace(/(\d+(\.\d+)?)%/g, '($1/100)');
            return s;
        }

        function safeEval(s) {
            s = sanitizeForEval(s);
            // avoid using eval directly; use Function to evaluate expression
            try {
                // eslint-disable-next-line no-new-func
                const fn = new Function('return ' + s);
                const result = fn();
                if (typeof result === 'number' && isFinite(result)) return result;
                throw new Error('Invalid result');
            } catch (e) {
                throw new Error('Kesalahan perhitungan');
            }
        }

        keys.addEventListener('click', e => {
            const btn = e.target.closest('button');
            if (!btn) return;
            const value = btn.getAttribute('data-value');
            const action = btn.getAttribute('data-action');

            if (action === 'clear') { expr = ''; history.textContent = '\u00A0'; updateDisplay(); return; }
            if (action === 'back') { expr = expr.slice(0, -1); updateDisplay(); return; }
            if (action === 'equals') {
                try {
                    const res = safeEval(expr || '0');
                    history.textContent = expr || '0';
                    expr = String(res);
                    updateDisplay();
                } catch (err) {
                    display.textContent = 'Error';
                }
                return;
            }

            // input value (digit, dot, operator)
            if (value) {
                // prevent multiple dots in a single number
                if (value === '.') {
                    const parts = expr.split(/[\+\-\*\/\(\)% ]+/);
                    const last = parts[parts.length - 1];
                    if (last.includes('.')) return;
                }
                expr += value;
                updateDisplay();
            }
        });

        // keyboard support
        window.addEventListener('keydown', e => {
            if (e.key === 'Enter') { e.preventDefault(); document.querySelector('[data-action="equals"]').click(); return; }
            if (e.key === 'Escape') { e.preventDefault(); document.querySelector('[data-action="clear"]').click(); return; }
            if (e.key === 'Backspace') { e.preventDefault(); document.querySelector('[data-action="back"]').click(); return; }
            const allowed = '0123456789+-*/().%';
            if (allowed.includes(e.key)) {
                e.preventDefault();
                // map / to /, * to *, etc.
                expr += e.key;
                updateDisplay();
            }
        });

        // init
        updateDisplay();
    </script>
</body>
</html>